<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
	This is an example modification file for SMF packages.

	ATTENTION: If you are trying to install this manually, you should try
	the package manager.  If it will not work for you, please take a look
	at the following for information on this format:
		http://mods.simplemachines.org/docs/manual-install.php

================================================================================

	Modification files can be used to modify files so that they do what
	your package needs them to do to work properly.

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">

	<id>digger:Watermark.light</id>
	<version>1.5</version>

	<file name="$sourcedir/Display.php">
	
		<operation>

			<search position="replace"><![CDATA[	if (empty($modSettings['enableCompressedOutput']) || filesize($filename) > 4194304)]]></search>

			<add><![CDATA[	if ((empty($modSettings['enableCompressedOutput']) && empty($modSettings['watermarkEnabled'])) || filesize($filename) > 4194304)]]></add>

    </operation>

		<operation>

			<search position="after"><![CDATA[	// On some of the less-bright hosts, readfile() is disabled.  It's just a faster, more byte safe, version of what's in the if.]]></search>

			<add><![CDATA[
  // * Watermark Mod by Digger
  elseif (!empty($modSettings['watermarkEnabled']) && !isset($callback))
  {
    include_once($sourcedir . '/Subs-Watermark.light.php');
    if (!@watermark($filename)) if (@readfile($filename) == null) echo file_get_contents($filename);
  }
  // Watermark Mod by Digger *

]]></add>

    </operation>

   </file>

</modification>
